<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Babl - High Performance WebSocket Server</title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://babl.ws/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;getting_started&#x2F;">
                                    
                                    Getting Started
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;application&#x2F;">
                                    
                                    Application
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;architecture&#x2F;">
                                    
                                    Architecture
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;lifecyle&#x2F;">
                                    
                                    Session Lifecycle
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;config&#x2F;">
                                    
                                    Configuration
                                </a>
                                
                            </li>
                        
                            
                            <li class="active">
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;monitoring&#x2F;">
                                    
                                    Monitoring
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;performance&#x2F;">
                                    
                                    Performance
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;javadocs&#x2F;">
                                    
                                    Java Docs
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
            </div>

            <div class="page__content">
                
                <div class="book-content">
                    
    <h1>Monitoring</h1>
    <p>In order to maintain a constant memory footprint, <strong>Babl</strong> exports metrics to memory-mapped files that 
can be processed by external programs. This approach keeps the reporting of metrics fast, while also 
ensuring that no allocation occurs due to 3rd-party monitoring libraries.</p>
<p>The recommended approach is to read and interpret the exported monitoring data, and push to a 
metrics back-end for processing.</p>
<h2 id="exported-metrics">Exported Metrics</h2>
<h3 id="server-statistics">Server Statistics</h3>
<p>Records server-wide statistics, contained in the server <em>mark-file</em> <code>${SERVER_DIR}/babl-server.mark</code>.</p>
<p>Can be read using the program <code>com.aitusoftware.babl.monitoring.SessionContainerStatisticsPrinter</code>:</p>
<pre style="background-color:#fdf6e3;">
<span style="color:#657b83;">$ java -cp babl-0.1.0-SNAPSHOT-all.jar \
    com.aitusoftware.babl.monitoring.SessionContainerStatisticsPrinter \
    $SERVER_DIR
Timestamp: 2021-03-14T15:32:05.358Z
Bytes Read:                       42826384
Bytes Written:                    42621246
Active Sessions:                       176
Back Pressure Events:                    2
Invalid Opcode Events:                   0
Max Event Loop Ms    :                   1
</span></pre>
<ul>
<li><em>Timestamp</em> - written by the server event-loop on each iteration, can be used as a liveness check</li>
<li><em>Bytes Read</em> - total number of bytes read from sockets</li>
<li><em>Bytes Written</em> - total number of bytes written to sockets</li>
<li><em>Active Sessions</em> - number of web-socket sessions currently connected</li>
<li><em>Back Pressure Events</em> - number of times the user <code>Application</code> could not keep up with incoming message rates</li>
<li><em>Invalid Opcode Events</em> - number of invalid web-socket frames received</li>
<li><em>Max Event Loop Ms</em> - max time (in milliseconds) spent processing all connected sessions</li>
</ul>
<h3 id="session-statistics">Session Statistics</h3>
<p>Records per-session statistics, contained in files named <code>${SERVER_DIR}/babl-session-statistics-N.data</code>.</p>
<p>Can be read using the program <code>com.aitusoftware.babl.monitoring.SessionStatisticsPrinter</code>:</p>
<pre style="background-color:#fdf6e3;">
<span style="color:#657b83;">$ java -cp babl-0.1.0-SNAPSHOT-all.jar \
    com.aitusoftware.babl.monitoring.SessionStatisticsPrinter \
    $SERVER_DIR
Session ID:                                 711
Session State:                        CONNECTED
Bytes Read:                              433878
Bytes Written:                           433397
Frames Decoded:                            1271
Frames Encoded:                            2043
Messages Received:                         1090
Messages Sent:                             2043
Receive Buffered Bytes:                       0
Send Buffered Bytes:                          0
Invalid Messages Received:                    0
Invalid Pings Received:                       0
Send Back Pressure Events:                    0
</span></pre>
<ul>
<li><em>Session ID</em> - server-assigned ID of the session</li>
<li><em>Session State</em> - current state of the session</li>
<li><em>Bytes Read</em> - total number of bytes read from session's socket</li>
<li><em>Bytes Written</em> - total number of bytes written to session's socket</li>
<li><em>Frames Decoded</em> - total number of web-socket frames decoded</li>
<li><em>Frames Encoded</em> - total number of web-socket frames encoded</li>
<li><em>Messages Received</em> - total number of complete messages received</li>
<li><em>Messages Sent</em> - total number of complete messages sent</li>
<li><em>Receive Buffered Bytes</em> - snapshot of the number of bytes currently queued for processing</li>
<li><em>Send Buffered Bytes</em> - snapshot of the number of bytes currently queued for sending</li>
<li><em>Invalid Messages Received</em> - total number of invalid messages received on the session</li>
<li><em>Invalid Pings Received</em> - total number of invalid pings received on the session</li>
<li><em>Send Back Pressure Events</em> - number of times the server has been unable to write data to the remote peer</li>
</ul>
<h3 id="errors">Errors</h3>
<p>Any exceptions are logged to an <code>ErrorBuffer</code> for efficient reporting, and can be viewed using the program
<code>com.aitusoftware.babl.monitoring.ErrorPrinter</code>:</p>
<pre style="background-color:#fdf6e3;">
<span style="color:#657b83;">$ java -cp babl-0.1.0-SNAPSHOT-all.jar \
    com.aitusoftware.babl.monitoring.ErrorPrinter \
    $SERVER_DIR
No errors reported.
</span></pre><h2 id="docker">Docker</h2>
<p>If running <strong>Babl</strong> in the supplied docker container, utility scripts are provided for viewing 
monitoring data:</p>
<ul>
<li><code>/babl/bin/babl_print_server_stats.sh</code></li>
<li><code>/babl/bin/babl_print_session_stats.sh</code></li>
<li><code>/babl/bin/babl_print_errors.sh</code></li>
</ul>
<p>If running the server in <code>DETACHED</code> mode, Aeron statistics can be displayed with:</p>
<ul>
<li><code>/babl/bin/babl_aeron_stat.sh</code></li>
</ul>


                </div>
            </div>

            <div class="prev-link">
                
    
    
    
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
                
                    <a class="previous" href="https:&#x2F;&#x2F;babl.ws&#x2F;config&#x2F;"><</a>
                
                
                
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    

            </div>

            <div class="next-link">
                
    
        
        
        
        
            
            
            
        
            
            
            
        
            
            
            
        
            
            
            
        
            
            
            
        
            
            
            
                
            
        
            
            
                <a class="next" href="https:&#x2F;&#x2F;babl.ws&#x2F;performance&#x2F;">></a>
                
                
            
            
        
            
            
            
        
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://babl.ws/book.js"></script>
        
    </body>

</html>
