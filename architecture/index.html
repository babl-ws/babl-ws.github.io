<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Babl - High Performance WebSocket Server</title>

      
      

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://babl.ws/book.css">
      

      
      
    </head>

    <body>
        <div class="menu">
            
            
            <nav role="navigation">
                <ul>
                    
                        
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;getting_started&#x2F;">
                                    
                                    Getting Started
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;application&#x2F;">
                                    
                                    Application
                                </a>
                                
                            </li>
                        
                            
                            <li class="active">
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;architecture&#x2F;">
                                    
                                    Architecture
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;lifecyle&#x2F;">
                                    
                                    Session Lifecycle
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;config&#x2F;">
                                    
                                    Configuration
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;monitoring&#x2F;">
                                    
                                    Monitoring
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;performance&#x2F;">
                                    
                                    Performance
                                </a>
                                
                            </li>
                        
                            
                            <li >
                                
                                <a href="https:&#x2F;&#x2F;babl.ws&#x2F;javadocs&#x2F;">
                                    
                                    Java Docs
                                </a>
                                
                            </li>
                        
                    
                </ul>
            </nav>
            
            
        </div>

        <div class="page">
            <div class="page__header">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
            </div>

            <div class="page__content">
                
                <div class="book-content">
                    
    <h1>Architecture</h1>
    <p><strong>Babl</strong> server is composed of two main parts - the <em>session container</em> responsible for handling web-socket connections, 
and the <em>application</em> an implementation of the <code>Application</code> interface that implements business logic.</p>
<p>The session container performs network I/O and protocol translation, sending received messages to the application.</p>
<p>The application sends messages back to the session container (to a specific session), where it will be converted back
into the web-socket protocol (and fragmented if needed).</p>
<p>The session container is also responsible for tracking liveness of sessions, sending <code>PING</code> messages and receiving 
<code>PONG</code> messages, on the application's behalf, to ensure that client connections are still active.</p>
<p><img src="https://babl.ws/architecture/website_architecture.png" alt="Architecture" title="Architecture" /></p>
<p>The session container also maintains statistics on the server as a whole, and active sessions. 
More information can be found in <a href="https://babl.ws/monitoring/">Monitoring</a>.</p>
<p>Depending on deployment and scaling requirements, the session container can communicate with the application directly.
In this mode, non-blocking network I/O and protocol translation is performed on the same thread as application
message processing.</p>
<p><code>DIRECT</code> mode is useful for simple deployments when sufficient client connections can be handled on a single thread.
Alternatively, for completely stateless applications that are merely gateways to a stateful back-end, multiple 
instances of the session container can be run. </p>
<p>For better scalability, <strong>Babl</strong> can be configured to run in <code>DETACHED</code> mode where multiple session containers
communicate with a single application instance over an efficient IPC mechanism. This mode allows the work of 
performing I/O and protocol translation to be scaled horizontally, while still allowing the application to 
run in a single-threaded context. </p>
<p>Deployment mode is configured by setting the following system property on the command-line, or in a configuration file:</p>
<p><code>babl.server.deployment.mode</code></p>
<p>Valid values are:</p>
<ul>
<li><code>DIRECT</code></li>
<li><code>DETACHED</code></li>
</ul>
<p>See <a href="https://babl.ws/config/">Configuration</a> for more information on configuration options.</p>
<h2 id="direct-mode">Direct mode</h2>
<p>In <code>DIRECT</code> mode, your application logic is executed directly as messages are received from web-socket clients.
Sessions are processed in the order provided by the operating system in response to an <code>epoll</code> call. </p>
<h2 id="detached-mode">Detached mode</h2>
<p>In <code>DETACHED</code> mode, one or more session containers will send received messages to the application over
<a href="https://github.com/real-logic/Aeron">Aeron</a> IPC. 
The application container will poll the IPC transport for new messages, and pass them to the 
application. When the application sends a response to a <code>Session</code> via the <code>send</code> method, the response
is written to the IPC, and delivered to the originating session container.</p>
<p><img src="https://babl.ws/architecture/website_architecture_detached.png" alt="Detached Mode Architecture" title="Detached Mode Architecture" /></p>
<p>Sending to a <code>Session</code> will return a <code>SendResult</code> value, which must be checked by the application. 
In the event that session containers are not able to keep up with the message flow out of the application,
the <code>send</code> method will return <code>SendResult.BACK_PRESSURE</code>. It is up to the application to decide what to
do at this point.</p>
<h3 id="multi-runtime-support">Multi-Runtime Support</h3>
<p>Messages exchanged between the session container and the application are encoded using 
<a href="https://github.com/real-logic/simple-binary-encoding">SBE</a>, so any supported language runtime
using Aeron (via C FFI or native client) can host the application logic. This makes the session container
a runtime- and language-agnostic web-socket server.</p>


                </div>
            </div>

            <div class="prev-link">
                
    
    
    
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
                
                    <a class="previous" href="https:&#x2F;&#x2F;babl.ws&#x2F;application&#x2F;"><</a>
                
                
                
            
        
    
        
        
            
        
    

            </div>

            <div class="next-link">
                
    
        
        
        
        
            
            
            
        
            
            
            
        
            
            
            
                
            
        
            
            
                <a class="next" href="https:&#x2F;&#x2F;babl.ws&#x2F;lifecyle&#x2F;">></a>
                
                
            
            
        
            
            
            
        
            
            
            
        
            
            
            
        
            
            
            
        
    

            </div>
        </div>

        
            
            <script type="text/javascript" src="https://babl.ws/book.js"></script>
        
    </body>

</html>
